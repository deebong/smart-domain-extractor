<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Domain Extractor Pro</title>
    <style>
        :root { 
            --primary: #2563eb; 
            --primary-hover: #1d4ed8;
            --bg: #f3f4f6; 
            --text: #1f2937; 
            --border: #d1d5db;
            --panel-bg: #ffffff;
            --scrollbar-thumb: #9ca3af;
        }

        /* Custom Scrollbars */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--scrollbar-thumb); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #6b7280; }
        * { scrollbar-width: thin; scrollbar-color: var(--scrollbar-thumb) transparent; }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            background: var(--bg); 
            color: var(--text); 
            padding: 20px; 
            height: 100vh; 
            margin: 0; 
            box-sizing: border-box; 
            display: flex; 
            flex-direction: column; 
        }

        h1 { margin: 0 0 15px; font-size: 1.4rem; color: #111827; display: flex; align-items: center; gap: 10px; }
        .badge { background: var(--primary); color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.7rem; vertical-align: middle; }

        .container { 
            display: grid; 
            grid-template-columns: 1fr 1fr 260px; 
            gap: 15px; 
            flex: 1; 
            min-height: 0; 
        }

        .panel { 
            background: var(--panel-bg); 
            border: 1px solid var(--border); 
            border-radius: 8px; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.1); 
        }

        .header { 
            padding: 10px 15px; 
            background: #f9fafb; 
            border-bottom: 1px solid var(--border); 
            font-weight: 600; 
            font-size: 0.85rem; 
            color: #374151; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }

        textarea { 
            flex: 1; 
            border: none; 
            padding: 15px; 
            resize: none; 
            outline: none; 
            font-family: "Menlo", "Consolas", monospace; 
            font-size: 13px; 
            line-height: 1.5;
            color: #1f2937;
        }

        /* Sidebar Styling */
        .sidebar { padding: 15px; overflow-y: auto; background: #fff; }
        
        .section-title { 
            font-size: 0.75rem; 
            text-transform: uppercase; 
            letter-spacing: 0.05em; 
            color: #6b7280; 
            margin: 15px 0 8px; 
            font-weight: 700; 
        }
        .section-title:first-child { margin-top: 0; }

        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .btn-grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; }
        .btn-full { width: 100%; display: block; margin-bottom: 8px; }

        button { 
            background: white; 
            border: 1px solid var(--border); 
            color: #374151; 
            padding: 8px 10px; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 0.85rem; 
            transition: all 0.2s; 
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        button:hover { border-color: var(--primary); color: var(--primary); background: #eff6ff; }
        
        button.primary-action { 
            background: var(--primary); 
            color: white; 
            border: 1px solid var(--primary); 
            font-weight: 600;
        }
        button.primary-action:hover { background: var(--primary-hover); }

        /* Stats Table */
        #stats-container { margin-top: 5px; }
        .stats-table { width: 100%; font-size: 0.85rem; border-collapse: collapse; }
        
        .stats-table tr { 
            cursor: pointer; 
            transition: background 0.1s; 
            border-bottom: 1px solid #f3f4f6;
        }
        .stats-table tr:hover { background-color: #f3f4f6; }
        
        /* Active Filter State */
        .stats-table tr.active-filter { 
            background-color: #dbeafe; 
            color: var(--primary); 
            font-weight: 600; 
        }
        
        .stats-table td { padding: 6px 4px; }
        .stats-table td:last-child { text-align: right; font-weight: 600; }
        .stats-table tr:last-child { border-bottom: none; }

        #output { color: #059669; font-weight: 600; }
        
        @media (max-width: 900px) {
            .container { grid-template-columns: 1fr; grid-template-rows: 1fr 1fr auto; }
            .sidebar { max-height: 300px; }
        }
    </style>
</head>
<body>

<h1>Domain Extractor <span class="badge">PRO</span></h1>

<div class="container">
    <div class="panel">
        <div class="header">
            Source Data
            <button style="padding: 2px 8px; font-size: 11px; height:auto;" onclick="document.getElementById('input').value=''">Clear</button>
        </div>
        <textarea id="input" placeholder="Paste scraped forum content here..."></textarea>
    </div>

    <div class="panel">
        <div class="header">
            <span id="output-label">Extracted Domains</span>
            <span id="count-badge" style="background:#e5e7eb; padding:2px 6px; border-radius:4px; font-size:11px">0</span>
        </div>
        <textarea id="output" readonly placeholder="Results will appear here..."></textarea>
    </div>

    <div class="panel sidebar">
        <button class="primary-action btn-full" onclick="runExtraction()">Extract Domains</button>
        
        <div class="section-title">Tools</div>
        <div class="btn-grid">
            <button id="btn-sort" onclick="toggleSort()">Sort: A ➝ Z</button>
            <button onclick="groupByTLD()">Group TLD</button>
        </div>
        
        <div style="height: 8px;"></div>

        <div class="btn-grid">
            <button onclick="applyFormat('camel')">CamelCase</button>
            <button onclick="applyFormat('lower')">lowercase</button>
        </div>

        <div class="section-title">Export</div>
        <div class="btn-grid-3">
            <button onclick="exportData('txt')">.TXT</button>
            <button onclick="exportData('csv')">.CSV</button>
            <button onclick="copyToClipboard()">Copy</button>
        </div>

        <div class="section-title" style="display:flex; justify-content:space-between; margin-top:20px;">
            <span>TLD Stats</span>
            <span style="font-size:0.65rem; cursor:pointer; text-decoration:underline;" onclick="resetFilter()">Show All</span>
        </div>
        <div id="stats-container" style="color:#9ca3af; font-size:0.8rem; font-style:italic;">
            No data yet...
        </div>
    </div>
</div>

<script>
    // Updated RISKY list to include .ai, .tech, .de to prevent sentence capture
    const RISKY_TLDS = new Set(["in", "me", "us", "to", "at", "it", "is", "on", "by", "my", "so", "go", "no", "do", "be", "or", "of", "an", "up", "info", "website", "tv", "app", "site", "ai", "tech", "de"]);
    
    const VALID_TLDS = [
        "co.uk", "com.au", "co.in", "net.in", "org.uk", "co.jp",
        "com", "net", "org", "io", "ai", "co", "xyz", "me", "in", 
        "us", "uk", "ca", "de", "jp", "fr", "au", "ch", "eu", "biz", 
        "info", "app", "dev", "site", "online", "store", "tech", 
        "website", "space", "club", "vip", "pro", "group", "ie", "tv", "cc"
    ];

    // Expanded Stop Words to include common false positives from your text
    const STOP_WORDS = [
        "sold", "via", "at", "for", "price", "domain", "name", "date", 
        "bin", "asking", "offer", "http", "https", "www", "venue", 
        "sale", "hold", "time", "cost", "profit", "purchase", "acquisition", 
        "bought", "bargain", "note", "initial", "hesitation", "drop", "registered",
        "renewal", "renewals", "reg", "handreg", "budget", "escrow", "fees", "fee",
        "search", "login", "register", "news", "vote", "poll", "thread", "posts",
        "hype", "market", "top", "why", "like", "sectors", "creme", "software",
        "agency", "startup", "type", "of", "sounds", "legitimate", "tool"
    ];

    let masterDomains = [];
    let visibleDomains = [];
    let sortDirection = 'asc';
    let activeFilter = null;

    function runExtraction() {
        const text = document.getElementById('input').value;
        const lines = text.split('\n');
        let rawResults = [];

        lines.forEach(line => {
            const extracted = processLine(line);
            if (extracted) rawResults.push(extracted);
        });

        masterDomains = [...new Set(rawResults)];
        activeFilter = null; 
        visibleDomains = [...masterDomains];
        updateUI();
    }

    function processLine(line) {
        if (!line || line.length < 4) return null;

        // 1. CLEAN LIST MARKERS & BULLETS (Fixes "1Neuracentral.com")
        // Removes "1. ", "1) ", "o ", "• " from start of line
        let cleanLine = line.replace(/^\s*(\d+[\.\)\-]|\*|o|•)\s+/, "");

        // 2. HARD BARRIERS (Fixes "Why: AI")
        // Treat colons, quotes, parens as walls.
        cleanLine = cleanLine.replace(/[:";\(\)]/g, " | ");

        // 3. Normalization (Visual tricks)
        let norm = cleanLine.replace(/ dawt /gi, ".")
                            .replace(/ dot /gi, ".")
                            .replace(/\[\.\]/g, ".")
                            .replace(/\[dot\]/gi, ".")
                            .replace(/•/g, ".");

        const tldRegex = new RegExp(`([\\.\\/\\s\\[])(${VALID_TLDS.join('|')})([\\s)\\]\\/,|!?]|$|:)`, 'gi');
        let match, bestCandidate = null;

        while ((match = tldRegex.exec(norm)) !== null) {
            const separator = match[1];
            const tld = match[2]; 
            const matchIndex = match.index;
            
            const isRisky = RISKY_TLDS.has(tld.toLowerCase());
            const isSpaceSep = separator === ' ';

            // RISKY TLD + SPACE CHECK
            // If it's a risky TLD (like .ai) and separated by space,
            // we are VERY strict. If preceding char is a letter, it's likely a word.
            if (isRisky && isSpaceSep) {
                const charBefore = norm[matchIndex - 1];
                if (charBefore && /[a-z0-9]/i.test(charBefore)) continue;
            }

            let leftSide = norm.substring(0, matchIndex);
            const stopRegex = new RegExp(`\\b(${STOP_WORDS.join('|')})\\b`, 'gi');
            let tempLeft = leftSide.replace(stopRegex, "|");
            
            // Clean Numbers/Prices
            tempLeft = tempLeft.replace(/[$€£]\s?[\d,.]+/g, "|"); 
            tempLeft = tempLeft.replace(/\b\d{4}\b/g, "|"); 
            
            const parts = tempLeft.split('|');
            let candidate = parts[parts.length - 1];
            
            // Sanitize
            let cleanName = candidate.replace(/[\s\/\[\]\(\)\.•․\\':",*\-]/g, "");

            // Gates
            if (cleanName.length < 2 || cleanName.length > 30) continue;
            
            // Sentence Logic
            if (candidate.includes(' ')) {
                const words = candidate.trim().split(/\s+/);
                const avgLen = words.reduce((a, b) => a + b.length, 0) / words.length;
                if (isRisky && isSpaceSep && avgLen > 2.5) continue; 
                if (isRisky && avgLen > 3) continue;
            }

            if (STOP_WORDS.includes(cleanName.toLowerCase())) continue;

            bestCandidate = cleanName + "." + tld.toLowerCase();
            // Break if we found a "strong" match (not risky space-sep)
            if (!isRisky || !isSpaceSep) break;
        }
        return bestCandidate;
    }

    function updateUI() {
        document.getElementById('output').value = visibleDomains.join('\n');
        document.getElementById('count-badge').innerText = visibleDomains.length;
        
        const label = document.getElementById('output-label');
        if (activeFilter) {
            label.innerText = `Domains ending in .${activeFilter}`;
            label.style.color = 'var(--primary)';
        } else {
            label.innerText = 'Extracted Domains';
            label.style.color = '#374151';
        }

        generateStats();
    }

    function generateStats() {
        const stats = {};
        masterDomains.forEach(d => {
            let tld = "";
            const lowerD = d.toLowerCase();
            for(let v of VALID_TLDS) {
                 if (lowerD.endsWith("." + v)) {
                     if (v.length > tld.length) tld = v;
                 }
            }
            if(!tld) tld = d.split('.').pop();
            stats[tld] = (stats[tld] || 0) + 1;
        });

        const sortedStats = Object.entries(stats).sort((a,b) => b[1] - a[1]);

        let html = '<table class="stats-table">';
        html += `<tr onclick="resetFilter()" class="${activeFilter === null ? 'active-filter' : ''}">
                    <td><strong>All Domains</strong></td>
                    <td>${masterDomains.length}</td>
                 </tr>`;

        sortedStats.forEach(([tld, count]) => {
            const isActive = activeFilter === tld ? 'active-filter' : '';
            html += `<tr onclick="filterByTLD('${tld}')" class="${isActive}">
                        <td>.${tld}</td>
                        <td>${count}</td>
                     </tr>`;
        });
        html += '</table>';

        document.getElementById('stats-container').innerHTML = html || 'No data';
    }

    function toggleSort() {
        sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
        document.getElementById('btn-sort').innerText = sortDirection === 'asc' ? 'Sort: A ➝ Z' : 'Sort: Z ➝ A';
        
        if (sortDirection === 'asc') {
            visibleDomains.sort((a, b) => a.toLowerCase().localeCompare(b.toLowerCase()));
        } else {
            visibleDomains.sort((a, b) => b.toLowerCase().localeCompare(a.toLowerCase()));
        }
        updateUI();
    }

    function groupByTLD() {
        if(activeFilter) activeFilter = null;
        visibleDomains = [...masterDomains];
        visibleDomains.sort((a, b) => {
            const extA = a.split('.').slice(1).join('.');
            const extB = b.split('.').slice(1).join('.');
            if (extA < extB) return -1;
            if (extA > extB) return 1;
            return a.toLowerCase().localeCompare(b.toLowerCase());
        });
        updateUI();
    }

    function filterByTLD(tld) {
        activeFilter = tld;
        visibleDomains = masterDomains.filter(d => d.toLowerCase().endsWith("." + tld));
        updateUI();
    }

    function resetFilter() {
        activeFilter = null;
        visibleDomains = [...masterDomains];
        updateUI();
    }

    function applyFormat(type) {
        if (type === 'lower') {
            visibleDomains = visibleDomains.map(d => d.toLowerCase());
            masterDomains = masterDomains.map(d => d.toLowerCase());
        } else if (type === 'camel') {
            const toCamel = (list) => list.map(d => {
                const parts = d.split('.');
                const name = parts[0];
                const ext = parts.slice(1).join('.');
                const newName = name.charAt(0).toUpperCase() + name.slice(1);
                return newName + "." + ext;
            });
            visibleDomains = toCamel(visibleDomains);
            masterDomains = toCamel(masterDomains);
        }
        updateUI();
    }

    function exportData(type) {
        if (visibleDomains.length === 0) return alert("Nothing to export!");
        let content = "", mime = "text/plain", filename = `domains_${activeFilter || 'all'}.txt`;

        if (type === 'csv') {
            content = "Domain,Extension\n" + visibleDomains.map(d => {
                let parts = d.split('.');
                let ext = parts.pop();
                if(parts.length > 1 && (ext === 'uk' || ext === 'au')) ext = parts.pop() + "." + ext; 
                let name = d.replace("."+ext, ""); 
                return `${name},${ext}`;
            }).join('\n');
            mime = "text/csv";
            filename = `domains_${activeFilter || 'all'}.csv`;
        } else {
            content = visibleDomains.join('\n');
        }

        const blob = new Blob([content], { type: mime });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        a.click();
        URL.revokeObjectURL(url);
    }

    function copyToClipboard() {
        const el = document.getElementById('output');
        el.select();
        document.execCommand('copy');
        const originalText = event.target.innerText;
        event.target.innerText = "Done!";
        setTimeout(() => event.target.innerText = originalText, 1500);
    }
</script>

</body>
</html>
